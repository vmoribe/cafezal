<div class="row">
<h1 class="text-center">Necessidade de Adubação Micronutrientes</h1>
<div class="col-md-6">
</div>
<div class="col-md-6">
<%= search_form_for @search, :class => "form-inline", url: analises_micronutrientes_path do |f| %>
<h3>Filtro</h3>
  <%= f.label :ano_eq, "Ano:" %>
  <%= f.search_field :ano_eq, :class => "text-center form-control"%>
  <%= f.label :fazenda_nome_cont, "Fazenda:" %>
  <%= f.search_field :fazenda_nome_cont, :class => "text-center form-control" %>
  <%= f.submit :class => 'btn btn-primary' %>
<% end %>
</div>


<%# Bloco Micronutrientes%>
<table class="table table-condensed">

<% @analises.select("DISTINCT(ano)").each do |p| %>
<% @parametro_ano = p.ano %>

<div class="col-xs-12 col-md-12"> <%# Divisão 1%>

    <table class="table table-condensed text-center"><%# Table 2%>

    </table><%# Table 2%>

  <% @necBoroSomaTotal = 0 %>
  <% @necCobreSomaTotal = 0 %>
  <% @necManganesSomaTotal = 0 %>
  <% @necZincoSomaTotal = 0 %>
  <% @necBoroSomaTotalHa = 0 %>
  <% @necCobreSomaTotalHa = 0 %>
  <% @necManganesSomaTotalHa = 0 %>
  <% @necZincoSomaTotalHa = 0 %>

  <% @analises.select("DISTINCT(fazenda_id)").where("(ano= ?)", @parametro_ano).each do |v| %>
  <% @faz_id = v.fazenda_id %>

<table class="table table-condensed text-center"> <%# Table 1%>
  
      <tbody><%# Body 1%>
  
  <% @necBoroSoma = 0 %>
  <% @necCobreSoma = 0 %>
  <% @necManganesSoma = 0 %>
  <% @necZincoSoma = 0 %>
  <% @necBoroSomaHa = 0 %>
  <% @necCobreSomaHa = 0 %>
  <% @necManganesSomaHa = 0 %>
  <% @necZincoSomaHa = 0 %>


<table class="table table-condensed text-center"> <%# Table 3%>
          <thead>
            <tr>
              <th>Fazenda</th>
              <th>Ano</th>
              <th>Talhão</th>
              <th>Área</th>
              <th>Boro</th>
              <th>Nec B (kg/ha)</th>
              <th>B Total (Kg)</th>
              <th>Cobre</th>
              <th>Nec Cu (kg/ha)</th>
              <th>Cu Total (Kg)</th>
              <th>Manganês</th>
              <th>Nec Mn (kg/ha)</th>
              <th>Mn Total (Kg)</th>
              <th>Zinco</th>
              <th>Nec Zn (kg/ha)</th>
              <th>Zn Total (Kg)</th>
            </tr>
          </thead>

<% @analises.where("(fazenda_id= ? AND ano= ? AND profundidade!= ?)", @faz_id, @parametro_ano, "20-40").order("talhao_id ASC").each do |analise| %>

	<% @necBoro = analise.necBoro %>
	<% @necCobre = analise.necCobre %>
	<% @necManganes = analise.necManganes %>
	<% @necZinco = analise.necZinco %>
  <% @necBoroHa = analise.necBoro * analise.talhao.area %>
  <% @necCobreHa = analise.necCobre * analise.talhao.area%>
  <% @necManganesHa = analise.necManganes * analise.talhao.area%>
  <% @necZincoHa = analise.necZinco * analise.talhao.area%>  

  <tbody>
   <tr>
    <td><%= analise.fazenda.nome %></td>
    <td><%= analise.ano %></td>
    <td><%= analise.talhao.nome %></td>
    <td><%= analise.talhao.area %></td>
    <td><%= analise.boro_b %></td>
    <td class="danger text-center"><%= valor_duascasas(@necBoro) %></td>
    <td><%= valor_duascasas(@necBoroHa) %></td>
    <td><%= analise.cobre_cu %></td>
    <td class="danger text-center"><%= valor_duascasas(@necCobre)%></td>
    <td><%= valor_duascasas(@necCobreHa) %></td>
    <td><%= analise.manganes_mn %></td>
    <td class="danger text-center"><%= valor_duascasas(@necManganes) %></td>
    <td><%= valor_duascasas(@necManganesHa) %></td>
    <td><%= analise.zinco_zn %></td>
    <td class="danger text-center"><%= valor_duascasas(@necZinco)%></td>
    <td><%= valor_duascasas(@necZincoHa) %></td>
   </tr>  

  <% @necBoroSoma += @necBoro %>
  <% @necCobreSoma += @necCobre %>
  <% @necManganesSoma += @necManganes %>
  <% @necZincoSoma += @necZinco %>
  <% @necBoroSomaHa += @necBoroHa %>
  <% @necCobreSomaHa += @necCobreHa %>
  <% @necManganesSomaHa += @necManganesHa %>
  <% @necZincoSomaHa += @necZincoHa %>  
<% end %>

  <tr>
    <th class="text-center"><b>Total</b></th>
    <th colspan="4"></th>
    <th class="text-center"><%= valor_duascasas(@necBoroSoma) %></th>
    <th class="text-center"><%= valor_duascasas(@necBoroSomaHa) %></th>
    <th colspan="1"></th>
    <th class="text-center"><%= valor_duascasas(@necCobreSoma) %></th>
    <th class="text-center"><%= valor_duascasas(@necCobreSomaHa) %></th>
    <th colspan="1"></th>
    <th class="text-center"><%= valor_duascasas(@necManganesSoma) %></th>
    <th class="text-center"><%= valor_duascasas(@necManganesSomaHa) %></th>
    <th colspan="1"></th>
    <th class="text-center"><%= valor_duascasas(@necZincoSoma) %></th>
    <th class="text-center"><%= valor_duascasas(@necZincoSomaHa) %></th>
  </tr>

	<% @necBoroSomaTotal += @necBoroSoma %>
	<% @necCobreSomaTotal += @necCobreSoma %>
	<% @necManganesSomaTotal += @necManganesSoma %>
	<% @necZincoSomaTotal += @necZincoSoma %>
  <% @necBoroSomaTotalHa += @necBoroSomaHa %>
  <% @necCobreSomaTotalHa += @necCobreSomaHa %>
  <% @necManganesSomaTotalHa += @necManganesSomaHa %>
  <% @necZincoSomaTotalHa += @necZincoSomaHa %>
   
  </tbody> 
</table> <%# Table 3%>
<% end %> <%# Fim Do Farm 1%> 
    </tbody><%# Fim Do Body 1%>
  </table> <%# Fim Table 1%>
</div> <%# Fim Divisão 1%>

<%# Fim Bloco Micronutrientes%>

<div class="col-md-6 col-md-offset-3">
<table class="table table-condensed table-striped"> <%# Table 4%>
  <thead>
  <tr>
    <th class="text-center"><%= @parametro_ano%></th>
    <th class="text-center"><b>Total Boro</b></th>
    <th class="text-center"><b>Total Cobre</b></th>
    <th class="text-center"><b>Total Manganês</b></th>    
    <th class="text-center"><b>Total Zinco</b></th>    
  </tr> 
  </thead>
  <tbody>
    <tr>
    <td class="text-center"><b>Total</b></td>
    <td class="text-center"><%= valor_duascasas(@necBoroSomaTotalHa) %></td>
    <td class="text-center"><%= valor_duascasas(@necCobreSomaTotalHa) %></td>
    <td class="text-center"><%= valor_duascasas(@necManganesSomaTotalHa) %></td>
    <td class="text-center"><%= valor_duascasas(@necZincoSomaTotalHa) %></td>
  </tr>

  </tbody>
</table><%# Fim Table 4%>
</div><%# Fim Div%>

<% end %> <%# End do ANO %>
